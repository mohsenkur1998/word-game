<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
</head>
<body>
{% for foo in all %}
<h5>{{ foo.rand_name }}</h5>
{% endfor %}
<h1 id="new"></h1>
    <form action="{% url "pick" %}" method="post" id="post-form">
        {% csrf_token %}
        <label for="words">write a word that starts with <span><h3>{{ last }}</h3></span></label>
        <input type="text" name="words">
        <label for="stu" id="stu"></label>
        <input type="text" name="stu" id="stud">
        <input type="submit" value="submit">
    </form>

<form method="get" name="get_form">
    <input type="text" name="dataa" id="dataa">
</form>
{#<form method="get">#}
{#    <input type="text" name="stud" id="stud">#}
{#</form>#}
{% if messages %}
    {% for message in messages %}
    {{ message }}
    {% endfor %}
{% endif %}

<h1>{{ time }}</h1>
<h3>Time Remaining: <span id="time_remaining"></span> seconds</h3>

{#  <h1>Timer Example</h1>#}
{#  <p>Enter your name:</p>#}
{#  <input type="text" id="name-input">#}
{#  <br>#}
{#  <button onclick="startTimer()">Start Timer</button>#}
{#  <div id="timer"></div>#}
{##}
{#  <script>#}
{#    var seconds = 10;#}
{#    var timerInterval;#}
{##}
{#    function startTimer() {#}
{#      // Start the timer#}
{#      timerInterval = setInterval(updateTimer, 1000);#}
{##}
{#      // Call the start_timer view to start the timer on the server-side#}
{#      var studentId = 'mohsen';  // Replace with the ID of the current student#}
{#      fetch(`/pick/?submitted_name=${studentId}`)#}
{#        .then(response => response.json())#}
{#        .then(data => console.log(data));#}
{#    }#}
{##}
{#    function updateTimer() {#}
{#      // Update the timer display#}
{#      var timerElement = document.getElementById('timer');#}
{#      timerElement.innerHTML = seconds + ' seconds left';#}
{##}
{#      // Check if the timer has expired#}
{#      if (seconds == 0) {#}
{#        clearInterval(timerInterval);#}
{#        timerElement.innerHTML = 'Time expired';#}
{##}
{#        // Call the delete_student view to delete the student object from the server-side#}
{#        var studentId = 'mohsen';  // Replace with the ID of the current student#}
{#        fetch(`/delete_student/?student=${studentId}`)#}
{#          .then(response => response.json())#}
{#          .then(data => console.log(data));#}
{#      }#}
{##}
{#      seconds--;#}
{#    }#}
{#  </script>#}

{#<h1 id="timer">Timer not started</h1>#}
{#<button onclick="startTimer('timer', {{ object.id }})">Start Timer</button>#}
{##}
{#<script>#}
{#    function startTimer(timerId, objectId) {#}
{#        var seconds = 10;  // change this to the desired countdown time in seconds#}
{##}
{#        function updateTimer() {#}
{#            document.getElementById(timerId).innerHTML = seconds + " seconds remaining";#}
{#            seconds--;#}
{##}
{#            if (seconds < 0) {#}
{#                clearTimeout(timer);#}
{#                deleteObject(objectId);#}
{#            }#}
{#        }#}
{##}
{#        updateTimer();#}
{#        var timer = setInterval(updateTimer, 1000);  // update every 1 second#}
{#    }#}
{##}
{#    function deleteObject(objectId) {#}
{#        // Send an AJAX request to delete the object from the Django backend#}
{#        var xhr = new XMLHttpRequest();#}
{#        xhr.open("POST", "/delete-object/", true);#}
{#        xhr.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");#}
{#        xhr.onreadystatechange = function () {#}
{#            if (xhr.readyState === XMLHttpRequest.DONE && xhr.status === 200) {#}
{#                // Object deleted successfully, perform any additional actions here#}
{#                alert('deleted')#}
{#            }#}
{#        };#}
{#        xhr.send("object_id=" + objectId);#}
{#    }#}
{#</script>#}




<script>
    const names = {{ all_names|safe }}


    function randomGenerator(names) {
                for (let i = 0; i < 2; i++) {
            const random = names[Math.floor(Math.random() * names.length)];
            return random;

        }
    }
    const randomName = randomGenerator(names);
    document.getElementById("stud").value = randomName;
    document.getElementById("dataa").value = randomName;

</script>



<script>
    // JavaScript code to update time remaining dynamically and reload page after time limit expires
    $(document).ready(function() {
        var end_time = {{ request.session.end_time }};
        timerInterval = setInterval(function() {
            var current_time = Math.round((new Date()).getTime() / 1000);
            var time_remaining = Math.round(end_time - current_time, 0);
            $('#time_remaining').text(time_remaining);


            if (time_remaining <= 0) {
                // Reload the page after time limit expires
                {#location.reload();#}
                clearInterval(timerInterval);
                alert("time up");
                {#var studentId = document.getElementById("dataa").value;  // Replace with the ID of the current student#}
                {#fetch(`/delete_student/${studentId}`)#}
                {#  .then(response => response.json())#}
                {#  .then(data => console.log(data));#}
                {#console.log(studentId)#}
                var oform = document.forms['get_form'];
                oform.submit()
                location.reload()
                {#var xhr = new XMLHttpRequest();#}
                {#xhr.open('GET', `/delete_student/${studentId}`, true);#}
                {##}
                {#xhr.setRequestHeader('Content-Type', 'application/json');#}
                {#xhr.send(JSON.stringify({'student': studentId}));#}
                {#console.log(studentId);#}
                {#console.log(xhr);#}
                {#console.log(oform)#}


            }
        }, 1000);
    });


</script>


</body>
</html>